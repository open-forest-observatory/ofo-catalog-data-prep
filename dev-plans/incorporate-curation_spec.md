I need to add functionality to a drone data ingestion pipeline. The pipeline reads folders (~missions) of contributed drone images and contributed missions-level metadata, extracts image-level metadata, sorts the imges into canonical missions and sub-missions based on the metadata, renames the image files, compiles a canonical set of metadata, copies/renames the images to a standardized file structure. I need to add functionality midway through the pipeline that accommodates human curation of the contributed images. A human has inspected the preliminary compiled metadata and identified issues and extraneous images etc and recorded this information. The pipeline needs to incorporate this information to develop a "post-curation" set if images and associated metadata. The specifications for this modification are defined in the bullets below. Your task is to turn this spec into a detailed implementation plan that has all the relevant details that a mid-level engineer could implement. The plan should be broken into discrete, numbered steps.

In doing this task,  tell me if anything doesn't seem to make sense or is inefficient and you see a better way to do things (potentially involving cutting out existing or planned steps, etc.). For example, do we still need deploy/drone-imagery-ingestion/01_raw-imagery-metadata-prep/06_summarize-exif-metadata-per-mission.R ? I guess so because we need it for the curation portal data catalog web pages that are created by deploy/drone-imagery-ingestion/10_drone-mission-web-catalog/11_create-drone-data-curation-webpages.R, but see if you agree, and even if so, see if there are other opportunities for simplification or improvement.

Read the scripts and potentially relevant data files when developing the implementation plan to ensure you have all the relevant details. Pay particular attention to the scripts in deploy/drone-imagery-ingestion/01_raw-imagery-metadata-prep.

Answer any questions or uncertainties I have mentioned in the spec below. And ask any questions about gaps that remain after you read it. It is very likely that I have not provided all the necessary details and I'd rather you ask than just make a guess.

Pay attention to whether we should make any existing code more modular so it can be re-used. And if so, then build that into the implementation plan.

-----

- Most/all file paths referenced below (and to be used in the scripts you create) are defined as constants in all caps in deploy/drone-imagery-ingestion/00_set-constants.R. You may have to add more to accommodate the pipeline expansion detailed below.
- Create updated versions of the mission-level and sub-mission-level metadata (for both the mission and the individual images) that include updated mission boundaries and image lists (to get there, see below). The mission- and sub-mission-level aggregated metadata should be updated (new versions made) to reflect the post-curation retained images, specifically to exclude the images listed in the curation notes csv at CURATION_NOTES_FILEPATH under the column extraneous_images. Note that the extraneous_images notation is to include multiple images separated by `, ` along with ranges indicated by ` to `. The first and last image of the range may be in reverse order. Note that the image names have the format `000036-01_000437` where the first number is the mission, the second is the sub-mission (well technically the sub-mission is `000036-01`), and the third is the image ID. In developing the implementation plan, read the curation csv to make sure that all notations for extraneous_images is accounted for. The image-level metadata can probably be pulled from the uncurated (contributed) imagery metadata files in PARSED_EXIF_FOR_RETAINED_IMAGES_PATH but has to be re-summarized at the mission and sub-mission level based on the images that are retained after this curation filtering. There are existing summarization functions; refer to steps 05, 06, and 07 under deploy/drone-imagery-ingestion/01_raw-imagery-metadata-prep. The image filenames should be preserved (potentially meaning gaps in the numbering; that is OK). The new scripts should go in deploy/drone-imagery-ingestion/01b_curated-raw-imagery-metadata-prep (01b because there is already a 02_x folder). But near the end of this full implementation, probably renumber the script folders (and possibly rename the alpha part more descriptively if necessary -- such as changing 02_raw-imagery-file-prep to 03_curated-imagery-file-prep -- while also updating the files that call these scripts).
- Important: note that for a certain designated set of missions, curation was performed using a previous set of drone photo locations. The metadata (gpkg) for them is at FORMERLY_CURATED_IMAGE_METADATA. The list of missions for which the former curation notes should apply is at FORMERLY_CURATED_MISSION_LIST. The key thing from the former curation notes is the list of extraneous_images. These had different filenames per image than in the current image metadata gpkg. To determine what the current filenames are, for the formerly curated missions, you need to spatially join the formerly curated mission image metadata to the current image metadata by image. Similarly, any references to images (can be detected by their 000000-00_000000 format) in other columns of the curation notes for formerly curated missions need to be updated before the curation notes get incorporated in the post-curation mission metadata.
- The mission- and sub-mission-level metadata should get a few new columns added to incorporate information from the curation notes csv at CURATION_NOTES_FILEPATH. Specifically, copy over the columns anomaly_severity, collection_time_anomaly	altitude_anomaly	spatial_anomaly	camera_pitch_anomaly	excess_images_anomaly	missing_images_anomaly	other_anomalies, and anomaly_notes, but the destination columns should have columns that begin with anomalies_*, e.g. anomalies_altitude. The exception is anomaly_notes and anomaly_severity, which should stay as they are. For aggreagating at the mission level, join across sub-missions within a column with `, `.
- Take the imagery sorting plans (one per mission, produed prior to curation) in IMAGE_EXIF_W_SORTING_PLAN_PATH (which 00_set-constants.R defines as '.../2_pre-curation-intermediate/...') and create new versions of them under a different folder which, instead of being called .../2_pre-curation-intermediate/... is called 5_post-curation-intermediate/... . This requires creating new directory constants in 00_set-constants.R as well as the script to create the modified sorting plans. Is this the right file to modify in preparation for running deploy/drone-imagery-ingestion/02_raw-imagery-file-prep/src/08_copy-images-to-standardized-folders.R on the post-curation retained images? - Modify the scripts in deploy/drone-imagery-ingestion/02_raw-imagery-file-prep to take the images in CONTRIBUTED_IMAGERY_PATH and ***. In addition to the changes necessary to accommodate the curation updates, also change the scripts to use symlinks instead of hardlinks. But will fix-exif work on symlinks?
- Update the scripts from deploy/drone-imagery-ingestion/02_raw-imagery-file-prep/src/08_copy-images-to-standardized-folders.R onward within deploy/drone-imagery-ingestion/02_raw-imagery-file-prep to operate on the post-curation images.

Ultimately, this should result in a set of (post-curation) files that can be used to generate the drone data catalog as is currently done by deploy/drone-imagery-ingestion/10_drone-mission-web-catalog/10_create-drone-data-catalog-webpages.R, and get all the mission data up to S3 as is currently done by deploy/drone-imagery-ingestion/02_raw-imagery-file-prep/src/12_upload-raw-imagery-to-object-store.R.